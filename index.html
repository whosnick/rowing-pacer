<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
    <title>Rowing Pacer v5.0</title>
    <meta name="theme-color" content="#0f2027"/>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div class="header">
        <h1>Rowing Pacer v5.0</h1>
        <button id="connectBtn">Connect BLE</button>
    </div>

    <div class="main">

        <!-- ================= SETUP VIEW ================= -->
        <div id="setupView" class="setup-container">
            <h2>Create Workout</h2>

            <div class="form-group">
                <label>Workout Type</label>
                <select id="workoutType">
                    <option value="time">Time Goal</option>
                    <option value="distance">Distance Goal</option>
                    <option value="interval">Intervals</option>
                </select>
            </div>

            <!-- Dynamic Settings Container -->
            <div id="workoutSettings">
                <!-- Injected via JS based on Type -->
            </div>
            <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
                <button id="historyBtn" class="icon-btn" style="background:var(--card);">üìÖ History</button>
            </div>
            <button id="startWorkoutBtn" class="action-btn">Ready to Row</button>
            <div class="setup-hint">Connect BLE first for auto-start</div>
        </div>

        <!-- ================= WORKOUT VIEW ================= -->
        <div id="workoutView" class="hidden">

            <!-- Progress Section -->
            <div class="progress-section">
                <div class="progress-labels">
                    <span id="progressLabelLeft">Interval 1/4</span>
                    <span id="progressLabelRight">Remaining: 00:00</span>
                </div>

                <!-- Main Progress (Total or Segments) -->
                <div class="progress-track">
                    <div id="progressBarMain" class="progress-fill"></div>
                    <div id="progressSegments" class="progress-segments"></div>
                </div>

                <!-- Interval Specific Progress -->
                <div id="intervalProgressContainer" class="progress-track sm hidden">
                    <div id="progressBarInterval" class="progress-fill secondary"></div>
                </div>
            </div>

            <!-- Pacer Animation -->
            <div class="pacer-container">
                <div class="phase-display">
                    <div id="targetPaceDisplay" class="target-spm-large">
                        Target: <span id="targetSPMVal">20</span> SPM
                    </div>
                </div>

                <div class="rowing-track">
                    <div id="rowerDot" class="rower-dot drive"></div>
                </div>

                <div class="timing-stats">
                    <span>Drive: <span id="driveTime">--</span></span>
                    <span id="phaseName" class="phase-name-mini">READY</span>
                    <span>Recov: <span id="recovTime">--</span></span>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Pace / 500m</div>
                    <div id="pace" class="stat-value">--:--</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Actual SPM</div>
                    <div id="spm" class="stat-value">--</div>
                    <div id="spmSource" class="spm-source">Idle</div>
                </div>
            </div>

            <div class="stats-secondary">
                <div class="stat-sm">
                    <div class="label">Time</div>
                    <div id="workoutTime" class="value">00:00</div>
                </div>
                <div class="stat-sm">
                    <div class="label">Strokes</div>
                    <div id="strokeCount" class="value">0</div>
                </div>
                <div class="stat-sm">
                    <div class="label">Dist</div>
                    <div id="distance" class="value">0m</div>
                </div>
            </div>

            <!-- Workout Controls -->
            <div class="controls-large">
                <button id="stopWorkoutBtn" class="stop-btn">End Workout</button>
            </div>
        </div>
        <!-- ================= HISTORY VIEW ================= -->
        <div id="historyView" class="hidden full-view">
            <div class="header-simple">
                <h2>Workout History</h2>
                <button id="closeHistoryBtn" class="icon-btn">Back</button>
            </div>
            
            <div class="history-controls">
                <button id="clearHistoryBtn" class="stop-btn" style="font-size:12px; padding:10px;">Delete All History</button>
            </div>

            <div id="historyList" class="history-list">
                <!-- JS Injected Items -->
            </div>
        </div>

        <!-- ================= DETAILS MODAL ================= -->
        <div id="detailsModal" class="modal hidden">
            <div class="modal-content">
                <h3 id="modalTitle">Workout Details</h3>
                <div id="modalSummary" class="modal-summary"></div>
                
                <div class="table-container">
                    <table id="modalTable">
                        <thead>
                            <tr>
                                <th>Seg</th>
                                <th>Time</th>
                                <th>Dist</th>
                                <th>SPM</th>
                            </tr>
                        </thead>
                        <tbody id="modalTableBody"></tbody>
                    </table>
                </div>
                <button id="closeModalBtn" class="action-btn">Close</button>
            </div>
        </div>
        <!-- System Controls (Bottom) -->
        <div class="controls footer-controls">
            <button id="audioBtn" class="icon-btn">üîä Sound</button>
            <button id="logBtn" class="icon-btn">üíæ Log</button>
            <button id="debugBtn" class="icon-btn">üêõ</button>
        </div>

        <div id="debug" class="debug"></div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>